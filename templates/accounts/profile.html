{% extends "base/base.html" %}
{% block title %}Mein Profil – PV-Protokoll SaaS{% endblock %}
{% block content %}
<div class="container py-5" style="background: #fff; border-radius: 12px; max-width: 700px;">
  <h2 class="fw-bold mb-4"><i class="bi bi-person-circle me-2"></i>Mein Profil</h2>
  {% if user.is_admin %}
  <div class="mb-3 text-end">
    <a href="{% url 'accounts:user_list' %}" class="btn btn-outline-secondary" data-bs-toggle="tooltip" title="Mitarbeiter verwalten"><i class="bi bi-people"></i> Mitarbeiter</a>
  </div>
{% endif %}
  <div class="mb-4">
    <div class="mb-3">
      <label class="form-label">Benutzername</label>
      <input type="text" class="form-control" value="{{ user.username }}" readonly>
    </div>
    <div class="mb-3">
      <label class="form-label">E-Mail</label>
      <input type="email" class="form-control" value="{{ user.email }}" readonly>
    </div>
    <div class="mb-3">
      <label class="form-label">Vorname</label>
      <input type="text" class="form-control" value="{{ user.first_name }}" readonly>
    </div>
    <div class="mb-3">
      <label class="form-label">Nachname</label>
      <input type="text" class="form-control" value="{{ user.last_name }}" readonly>
    </div>
    <div class="mb-3">
      <label class="form-label">Rolle</label>
      <input type="text" class="form-control" value="{{ user.get_role_display|default:user.role }}" readonly>
      {% if user.is_superuser %}
      <div class="form-text">Als Administrator kannst du die Rolle anderer Nutzer in der Benutzerverwaltung ändern.</div>
      {% endif %}
    </div>
    <a href="/accounts/password_change/" class="btn btn-outline-secondary" data-bs-toggle="tooltip" title="Passwort ändern"><i class="bi bi-key"></i> Passwort ändern</a>
  </div>
  {% if user.is_superuser %}
  <hr>
  <h3 class="fw-bold mb-3">Benutzerverwaltung</h3>
  <table class="table table-bordered table-hover bg-white">
    <thead>
      <tr>
        <th>Benutzername</th>
        <th>E-Mail</th>
        <th>Rolle</th>
        <th>Aktionen</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.username }}</td>
        <td>{{ u.email }}</td>
        <td>
          <form method="post" action="/accounts/change_role/{{ u.id }}/">
            {% csrf_token %}
            <select name="role" class="form-select form-select-sm" {% if u == user %}disabled{% endif %}>
              <option value="admin" {% if u.role == 'admin' %}selected{% endif %}>Admin</option>
              <option value="technician" {% if u.role == 'technician' %}selected{% endif %}>Techniker</option>
              <option value="customer" {% if u.role == 'customer' %}selected{% endif %}>Kunde</option>
            </select>
            {% if u != user %}
            <button type="submit" class="btn btn-sm btn-outline-primary mt-1" data-bs-toggle="tooltip" title="Rolle ändern"><i class="bi bi-arrow-repeat"></i> Rolle ändern</button>
            {% endif %}
          </form>
        </td>
        <td>
          {% if u != user %}
          <form method="post" action="/accounts/delete_user/{{ u.id }}/" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger" data-bs-toggle="tooltip" title="Benutzer löschen" onclick="return confirm('Benutzer wirklich löschen?')"><i class="bi bi-trash"></i> Löschen</button>
          </form>
          {% else %}
          <span class="text-muted">–</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
{% endblock %}
<script>
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.forEach(function (tooltipTriggerEl) {
    new bootstrap.Tooltip(tooltipTriggerEl);
  });
</script> 